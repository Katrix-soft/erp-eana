<div class="p-4 sm:p-6 lg:p-8 space-y-6 lg:space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700">

    <!-- Header Controls -->
    <div class="flex flex-col lg:flex-row gap-4 lg:items-center justify-between">
        <!-- Search Bar -->
        <div class="relative flex-grow max-w-2xl group">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <lucide-icon [name]="Search" [size]="20"
                    class="text-slate-500 group-focus-within:text-blue-500 transition-colors"></lucide-icon>
            </div>
            <input type="text" [(ngModel)]="searchTerm" placeholder="Buscar por radio, frecuencia o aeropuerto..."
                class="block w-full pl-11 pr-4 py-3 bg-slate-900 border border-slate-800 rounded-xl text-slate-200 placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all shadow-sm hover:bg-slate-800/50 focus:bg-slate-900">
        </div>

        <!-- Sort Controls -->
        <div class="flex items-center p-1 bg-slate-900 border border-slate-800 rounded-xl">
            <button *ngFor="let sort of ['STATUS', 'FREQ', 'NAME']" (click)="setSort(sort)"
                class="px-4 py-2 rounded-lg text-xs font-bold transition-all uppercase tracking-wider"
                [ngClass]="sortBy === sort ? 'bg-blue-600 text-white shadow-md shadow-blue-900/20' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800'">
                {{ sort }}
            </button>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex flex-col items-center justify-center py-32 space-y-6">
        <div class="relative">
            <div class="w-16 h-16 border-4 border-slate-800 rounded-full"></div>
            <div
                class="absolute top-0 w-16 h-16 border-4 border-blue-500/50 border-t-blue-500 rounded-full animate-spin">
            </div>
        </div>
        <p class="text-slate-500 font-medium animate-pulse tracking-wide uppercase text-sm">Sincronizando flotas...</p>
    </div>

    <!-- Grid -->
    <div *ngIf="!loading" class="grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-3 gap-6">
        <div *ngFor="let radio of filteredRadios"
            class="group relative bg-gradient-to-br from-slate-900 to-slate-950 rounded-3xl overflow-hidden border-2 transition-all duration-500 transform hover:-translate-y-1 hover:shadow-2xl"
            [ngClass]="getCardStyles(radio.estado)">

            <!-- Borde izquierdo dinámico -->
            <div class="absolute left-0 top-0 bottom-0 w-2 bg-gradient-to-b" [ngClass]="getBumperStyles(radio.estado)">
            </div>

            <div class="px-6 py-5 flex flex-col min-h-[300px] relative z-10 w-full">

                <!-- Badge "CON NOVEDAD" en la esquina superior derecha -->
                <div *ngIf="radio.estado !== 'OK'"
                    class="absolute top-4 right-4 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest shadow-lg"
                    [ngClass]="{
                        'bg-yellow-400 text-black': radio.estado === 'NOVEDAD',
                        'bg-red-600 text-white': radio.estado === 'FUERA_SERVICIO'
                    }">
                    {{ ESTADO_LABELS[radio.estado] || radio.estado }}
                </div>

                <!-- Marca y Modelo -->
                <div class="mb-2">
                    <h3 class="text-xl font-bold text-white tracking-tight leading-tight">
                        {{ radio.model || 'Modelo Desconocido' }}
                    </h3>
                </div>

                <!-- Ubicación -->
                <div class="mb-4">
                    <p class="text-sm font-semibold text-slate-400 uppercase tracking-wider">
                        {{ radio.aeropuerto?.aeropuerto || radio.name }}
                    </p>
                </div>

                <!-- Frecuencia (Grande y centrada) -->
                <div class="flex-grow flex flex-col items-center justify-center mb-4">
                    <div class="flex items-baseline gap-2">
                        <span
                            class="text-6xl font-black tracking-tighter text-white font-mono leading-none drop-shadow-[0_0_20px_rgba(255,255,255,0.15)]">
                            {{ radio.frequency ? (radio.frequency | number:'1.3-3') : '---' }}
                        </span>
                        <span *ngIf="radio.frequency" class="text-lg font-bold text-slate-500 uppercase">MHz</span>
                    </div>
                </div>

                <!-- Estado del Equipo (EQ 2 - F.S) -->
                <div class="mb-4 space-y-3">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div
                                class="flex items-center gap-2 bg-slate-800/50 px-3 py-1.5 rounded-lg border border-slate-700/50">
                                <div class="w-2 h-2 rounded-full"
                                    [ngClass]="radio.activeSide === 'MAIN' ? 'bg-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.8)]' : 'bg-slate-600'">
                                </div>
                                <span class="text-xs font-bold text-slate-300 uppercase">
                                    {{ radio.activeSide === 'MAIN' ? 'EQ 1' : 'EQ 2' }}
                                </span>
                            </div>
                            <span class="text-xs font-bold text-slate-500">-</span>
                            <span class="text-xs font-bold uppercase tracking-wider" [ngClass]="{
                                    'text-green-400': radio.estado === 'OK',
                                    'text-yellow-400': radio.estado === 'NOVEDAD',
                                    'text-red-400': radio.estado === 'FUERA_SERVICIO'
                                }">
                                {{ radio.estado === 'OK' ? 'OP' : (radio.estado === 'NOVEDAD' ? 'NOV' : 'F.S') }}
                            </span>
                        </div>

                        <!-- Indicador Al Aire -->
                        <div *ngIf="radio.activeSide === radio.onAirSide"
                            class="px-2 py-1 bg-green-500/20 border border-green-500/30 rounded text-[9px] font-black text-green-400 animate-pulse tracking-widest">
                            AL AIRE
                        </div>

                        <!-- Viñeta de Checklist Pendiente (30-45 días) -->
                        <div *ngIf="radio.checklistWarning"
                            class="px-2 py-1 bg-orange-500/20 border border-orange-500/40 rounded text-[9px] font-black text-orange-400 flex items-center gap-1 shadow-lg shadow-orange-500/5">
                            <lucide-icon [name]="Signal" [size]="10"></lucide-icon>
                            {{ radio.checklistWarning | uppercase }}
                        </div>
                    </div>

                    <!-- Selector de Equipo (EQ 1 / EQ 2) y Conmutar -->
                    <div class="flex flex-col gap-3">
                        <div
                            class="flex items-center gap-1 bg-slate-950/50 p-1 rounded-xl border border-slate-800/50 w-full">
                            <button (click)="setSide(radio, 'MAIN')"
                                class="flex-1 px-3 py-1.5 rounded-lg transition-all text-[10px] font-bold tracking-widest"
                                [ngClass]="radio.activeSide === 'MAIN' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/40' : 'text-slate-500 hover:text-slate-300'">
                                EQ 1
                            </button>
                            <button (click)="setSide(radio, 'STANDBY')"
                                class="flex-1 px-3 py-1.5 rounded-lg transition-all text-[10px] font-bold tracking-widest"
                                [ngClass]="radio.activeSide === 'STANDBY' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/40' : 'text-slate-500 hover:text-slate-300'">
                                EQ 2
                            </button>
                        </div>

                        <!-- Botones de Acción -->
                        <div class="grid grid-cols-2 gap-3 mt-1">
                            <button (click)="handleToggleRequest($event, radio)"
                                class="flex items-center justify-center gap-2 px-3 py-2.5 bg-slate-900 hover:bg-slate-800 text-blue-400 text-[10px] font-black rounded-xl transition-all active:scale-95 border border-slate-700/50 group/btn shadow-lg uppercase tracking-wider">
                                <lucide-icon [name]="Signal" [size]="14"
                                    class="group-hover/btn:scale-110 transition-transform"></lucide-icon>
                                <span>Conmutar</span>
                            </button>

                            <div class="grid grid-cols-2 gap-2">
                                <button (click)="askAI(radio)"
                                    class="flex items-center justify-center bg-slate-900 hover:bg-blue-900/40 text-blue-400 p-2 text-[10px] font-black rounded-xl transition-all border border-blue-500/30 group/ai shadow-lg uppercase tracking-wider"
                                    title="Consultar a EANA AI">
                                    <lucide-icon [name]="Sparkles" [size]="14"
                                        class="group-hover/ai:animate-pulse"></lucide-icon>
                                </button>

                                <button (click)="navigateToChecklist(radio.id)"
                                    class="flex items-center justify-center gap-2 bg-gradient-to-r from-slate-800 to-slate-700 hover:from-slate-700 hover:to-slate-600 text-white p-2 text-[10px] font-black rounded-xl transition-all active:scale-95 border border-slate-600 group/btn shadow-lg uppercase tracking-wider">
                                    <lucide-icon [name]="ChevronRight" [size]="14"
                                        class="group-hover/btn:translate-x-1 transition-transform"></lucide-icon>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secondary Alert Banner (If needed) -->
                <div *ngIf="radio.secondaryStatusLabel"
                    class="absolute top-16 right-4 text-[9px] font-bold px-2 py-1 rounded bg-slate-900 border border-slate-700 text-slate-400 opacity-80 pointer-events-none shadow-xl z-20">
                    {{ radio.secondaryStatusLabel }}
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <app-confirm-modal [isOpen]="showConfirmModal" [title]="confirmModalTitle" [message]="confirmModalMessage"
        confirmText="Confirmar Cambio" cancelText="Cancelar" type="warning" (onConfirm)="confirmToggle()"
        (onCancel)="closeConfirmModal()">
    </app-confirm-modal>
</div>