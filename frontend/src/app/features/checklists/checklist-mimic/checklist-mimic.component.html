<!-- VIEW / EDIT MODE (Mimic View) - Oculto durante la impresión -->
<div class="min-h-screen bg-slate-950 text-slate-200 p-6 font-mono print:hidden" *ngIf="checklist">
    <!-- Top Bar -->
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8 pb-4 border-b border-slate-800">
        <div class="flex items-center justify-between w-full sm:w-auto">
            <button (click)="goBack()"
                class="flex items-center gap-2 text-slate-400 hover:text-white transition-colors">
                <lucide-icon [name]="ArrowLeft" [size]="20"></lucide-icon>
                <span class="font-bold">VOLVER</span>
            </button>
            <div class="sm:hidden text-right">
                <div class="text-[10px] text-slate-500 uppercase tracking-widest">ID Reporte</div>
                <div class="font-bold text-sm">#{{ checklist.id }}</div>
            </div>
        </div>

        <div class="flex flex-wrap items-center gap-3 w-full sm:w-auto">
            <button (click)="createNewFromThis()"
                class="px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-all flex items-center justify-center gap-2 text-sm shadow-lg shadow-emerald-600/20">
                <lucide-icon [name]="Plus" [size]="18"></lucide-icon>
                NUEVO CHECKLIST
            </button>
            <button (click)="isEditing = !isEditing"
                class="flex-1 sm:flex-none px-4 py-2 rounded-lg font-bold transition-all text-sm border border-slate-700 hover:bg-slate-800"
                [ngClass]="isEditing ? 'bg-slate-800 text-white' : 'text-slate-400'">
                {{ isEditing ? 'CANCELAR' : 'EDITAR' }}
            </button>
            <button (click)="print()"
                class="px-4 py-2 bg-slate-800 text-white rounded-lg font-bold hover:bg-slate-700 transition-all flex items-center justify-center gap-2 text-sm">
                <lucide-icon [name]="Printer" [size]="18"></lucide-icon>
                IMPRIMIR
            </button>
            <div class="hidden sm:block h-8 w-px bg-slate-800"></div>
            <div class="hidden sm:block text-right">
                <div class="text-xs text-slate-500 uppercase tracking-widest">ID Reporte</div>
                <div class="font-bold">#{{ checklist.id }}</div>
            </div>
        </div>
    </div>

    <div class="max-w-5xl mx-auto space-y-6">
        <!-- Status Control Panel -->
        <div class="bg-slate-900 rounded-2xl p-3 sm:p-4 border border-slate-800 transition-all duration-300"
            [ngClass]="{'opacity-75 pointer-events-none': !isEditing}">
            <div class="flex flex-col lg:flex-row gap-3">
                <button (click)="handleStatusChange('OPERATIVO')" [disabled]="!isEditing"
                    class="flex-1 p-3 sm:p-4 rounded-xl border transition-all duration-300 flex items-center justify-center gap-2 sm:gap-3 group"
                    [ngClass]="checklist.estado === 'OPERATIVO'
                        ? 'bg-emerald-500/20 border-emerald-500/50 text-emerald-400 shadow-[0_0_20px_rgba(16,185,129,0.2)]'
                        : 'bg-slate-950 border-slate-800 text-slate-400 hover:border-emerald-500/30 hover:text-emerald-400'">
                    <div class="w-2.5 h-2.5 rounded-full"
                        [ngClass]="checklist.estado === 'OPERATIVO' ? 'bg-emerald-400 shadow-[0_0_10px_rgba(52,211,153,0.8)]' : 'bg-slate-700'">
                    </div>
                    <span class="font-bold text-xs sm:text-base">PONER EN SERVICIO</span>
                    <lucide-icon [name]="CheckCircle" [size]="18" class="transition-opacity"
                        [ngClass]="checklist.estado === 'OPERATIVO' ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'"></lucide-icon>
                </button>

                <button (click)="handleStatusChange('PRECAUCION')" [disabled]="!isEditing"
                    class="flex-1 p-3 sm:p-4 rounded-xl border transition-all duration-300 flex items-center justify-center gap-2 sm:gap-3 group"
                    [ngClass]="checklist.estado === 'PRECAUCION'
                        ? 'bg-amber-500/20 border-amber-500/50 text-amber-400 shadow-[0_0_20px_rgba(245,158,11,0.2)]'
                        : 'bg-slate-950 border-slate-800 text-slate-400 hover:border-amber-500/30 hover:text-amber-400'">
                    <div class="w-2.5 h-2.5 rounded-full"
                        [ngClass]="checklist.estado === 'PRECAUCION' ? 'bg-amber-400 shadow-[0_0_10px_rgba(251,191,36,0.8)]' : 'bg-slate-700'">
                    </div>
                    <span class="font-bold text-xs sm:text-base">MODO PRECAUCIÓN</span>
                    <lucide-icon [name]="AlertTriangle" [size]="18" class="transition-opacity"
                        [ngClass]="checklist.estado === 'PRECAUCION' ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'"></lucide-icon>
                </button>

                <button (click)="handleStatusChange('FALLA')" [disabled]="!isEditing"
                    class="flex-1 p-3 sm:p-4 rounded-xl border transition-all duration-300 flex items-center justify-center gap-2 sm:gap-3 group"
                    [ngClass]="checklist.estado === 'FALLA'
                        ? 'bg-red-500/20 border-red-500/50 text-red-400 shadow-[0_0_20px_rgba(239,68,68,0.2)]'
                        : 'bg-slate-950 border-slate-800 text-slate-400 hover:border-red-500/30 hover:text-red-400'">
                    <div class="w-2.5 h-2.5 rounded-full"
                        [ngClass]="checklist.estado === 'FALLA' ? 'bg-red-400 shadow-[0_0_10px_rgba(248,113,113,0.8)]' : 'bg-slate-700'">
                    </div>
                    <span class="font-bold text-xs sm:text-base">SACAR DE SERVICIO</span>
                    <lucide-icon [name]="Power" [size]="18" class="transition-opacity"
                        [ngClass]="checklist.estado === 'FALLA' ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'"></lucide-icon>
                </button>
            </div>
        </div>

        <!-- Main Status Display (View Mode) -->
        <div *ngIf="!isEditing"
            class="bg-slate-900 rounded-2xl sm:rounded-3xl p-6 sm:p-8 border border-slate-800 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 opacity-10 blur-3xl rounded-full -mr-20 -mt-20 pointer-events-none bg-gradient-to-br"
                [ngClass]="getStatusGradient(checklist.estado)"></div>

            <div class="relative z-10">
                <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-6 mb-8">
                    <div>
                        <div class="flex items-center gap-3 mb-1">
                            <h1 class="text-2xl sm:text-3xl font-black text-white leading-tight uppercase">{{
                                checklist.estacion }}</h1>
                            <div *ngIf="checklist.equipoRole"
                                class="px-3 py-0.5 bg-blue-500 text-white text-[10px] font-black rounded-md tracking-widest shadow-lg shadow-blue-500/20">
                                {{ checklist.equipoRole }}
                            </div>
                        </div>
                        <div class="flex flex-wrap items-center gap-x-4 gap-y-1">
                            <p class="text-slate-400 flex items-center gap-2 text-xs sm:text-sm font-bold">
                                <lucide-icon [name]="Server" [size]="14" class="text-blue-400"></lucide-icon>
                                {{ checklist.equipo?.marca || 'R&S' }} {{ checklist.equipo?.modelo || 'Series 4200' }}
                            </p>
                            <div *ngIf="checklist.equipo?.frecuencias?.[0]?.frecuencia"
                                class="text-xs font-black text-slate-500 flex items-center gap-1">
                                <span class="w-1 h-1 bg-slate-700 rounded-full"></span>
                                {{ checklist.equipo.frecuencias[0].frecuencia | number:'1.3-3' }} MHz
                            </div>
                        </div>

                        <!-- Estado del Par (Redundancia) -->
                        <div *ngIf="checklist.partnerStatus" class="mt-3 flex flex-col gap-2">
                            <div class="flex items-center gap-2">
                                <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Respaldo:
                                </div>
                                <div class="text-[10px] font-black uppercase tracking-wider px-2 py-0.5 rounded border border-white/5 bg-white/5 active:scale-95 transition-all cursor-pointer"
                                    [ngClass]="checklist.partnerStatusClass"
                                    (click)="showPartnerActions = !showPartnerActions">
                                    {{ checklist.equipoRole === 'EQUIPO 1' ? 'EQ 2' : 'EQ 1' }} - {{
                                    checklist.partnerStatus }}
                                    <lucide-icon [name]="Edit" [size]="10"
                                        class="inline-block ml-1 opacity-50"></lucide-icon>
                                </div>
                            </div>

                            <!-- Botones Rápidos para el Respaldo -->
                            <div *ngIf="showPartnerActions"
                                class="flex gap-2 p-2 bg-slate-950/80 rounded-lg border border-slate-800 animate-in fade-in slide-in-from-top-2 duration-200">
                                <button (click)="handlePartnerStatusChange('OPERATIVO'); showPartnerActions = false"
                                    class="w-8 h-8 rounded-lg bg-emerald-500/20 text-emerald-400 flex items-center justify-center hover:bg-emerald-500 hover:text-white transition-all shadow-lg hover:shadow-emerald-500/20"
                                    title="Poner en Servicio">
                                    <lucide-icon [name]="CheckCircle" [size]="14"></lucide-icon>
                                </button>
                                <button (click)="handlePartnerStatusChange('PRECAUCION'); showPartnerActions = false"
                                    class="w-8 h-8 rounded-lg bg-amber-500/20 text-amber-400 flex items-center justify-center hover:bg-amber-500 hover:text-white transition-all shadow-lg hover:shadow-amber-500/20"
                                    title="Modo Precaución">
                                    <lucide-icon [name]="AlertTriangle" [size]="14"></lucide-icon>
                                </button>
                                <button (click)="handlePartnerStatusChange('FALLA'); showPartnerActions = false"
                                    class="w-8 h-8 rounded-lg bg-red-500/20 text-red-400 flex items-center justify-center hover:bg-red-500 hover:text-white transition-all shadow-lg hover:shadow-red-500/20"
                                    title="Sacar de Servicio">
                                    <lucide-icon [name]="Power" [size]="14"></lucide-icon>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="px-4 py-2 rounded-xl border flex flex-col items-center gap-0.5 self-start transition-all shadow-xl"
                        [ngClass]="getStatusColor(checklist.estado)">
                        <div class="flex items-center gap-2">
                            <lucide-icon [name]="Activity" [size]="16"
                                [ngClass]="{'animate-pulse': checklist.estado === 'FALLA' || checklist.estado === 'PRECAUCION'}"></lucide-icon>
                            <span class="font-black tracking-widest text-sm uppercase">{{ checklist.estado }}</span>
                        </div>
                        <span class="text-[9px] font-black opacity-60 uppercase tracking-tighter">Estado en {{
                            checklist.equipoRole || 'SITIO' }}</span>
                    </div>
                </div>

                <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                    <div class="bg-slate-950/50 p-3 sm:p-4 rounded-xl border border-slate-800 backdrop-blur-sm">
                        <div class="text-[10px] sm:text-xs text-slate-500 mb-1 font-bold tracking-wider uppercase">
                            POTENCIA TX</div>
                        <div class="text-xl sm:text-2xl font-bold text-emerald-400">49.8 W</div>
                    </div>
                    <div class="bg-slate-950/50 p-3 sm:p-4 rounded-xl border border-slate-800 backdrop-blur-sm">
                        <div class="text-[10px] sm:text-xs text-slate-500 mb-1 font-bold tracking-wider uppercase">VSWR
                        </div>
                        <div class="text-xl sm:text-2xl font-bold text-blue-400">1.02</div>
                    </div>
                    <div class="bg-slate-950/50 p-3 sm:p-4 rounded-xl border border-slate-800 backdrop-blur-sm">
                        <div class="text-[10px] sm:text-xs text-slate-500 mb-1 font-bold tracking-wider uppercase">
                            MODULACIÓN</div>
                        <div class="text-xl sm:text-2xl font-bold text-purple-400">85%</div>
                    </div>
                    <div class="bg-slate-950/50 p-3 sm:p-4 rounded-xl border border-slate-800 backdrop-blur-sm">
                        <div class="text-[10px] sm:text-xs text-slate-500 mb-1 font-bold tracking-wider uppercase">TEMP
                        </div>
                        <div class="text-xl sm:text-2xl font-bold text-amber-400">42°C</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Form -->
        <div *ngIf="isEditing" [formGroup]="form"
            class="bg-slate-900 rounded-3xl p-8 border border-slate-800 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <lucide-icon [name]="Edit" [size]="24" class="text-blue-500"></lucide-icon>
                Editar Checklist
            </h2>

            <div class="mb-8">
                <app-checklist-steps [form]="form"></app-checklist-steps>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div class="space-y-2 md:col-span-2">
                    <label class="text-sm text-slate-400 font-medium">Observaciones</label>
                    <textarea formControlName="observaciones"
                        class="w-full bg-slate-950 border border-slate-800 rounded-xl p-4 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all min-h-[100px]"
                        placeholder="Ingrese detalles sobre el estado del equipo..."></textarea>
                </div>
            </div>

            <div class="pt-6 border-t border-slate-800 flex justify-end gap-4">
                <button (click)="isEditing = false"
                    class="px-6 py-3 rounded-xl font-bold text-slate-400 hover:text-white hover:bg-slate-800 transition-colors">
                    CANCELAR
                </button>
                <button (click)="handleSave()"
                    class="px-6 py-3 rounded-xl font-bold bg-blue-600 text-white hover:bg-blue-700 shadow-lg shadow-blue-600/20 transition-all hover:scale-105 active:scale-95">
                    GUARDAR CAMBIOS
                </button>
            </div>
        </div>

        <!-- Failure Report -->
        <div *ngIf="getFailures().length > 0"
            class="bg-red-500/10 border border-red-500/20 rounded-2xl p-6 animate-pulse">
            <div class="flex items-center gap-2 text-red-400 font-bold mb-4">
                <lucide-icon [name]="AlertCircle" [size]="24"></lucide-icon>
                <span>FALLAS DETECTADAS</span>
            </div>
            <div class="space-y-2">
                <div *ngFor="let failure of getFailures()"
                    class="w-full text-left p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-300 flex items-center justify-between">
                    <span class="font-medium">{{ fieldLabels[failure[0]] }}</span>
                    <lucide-icon [name]="XCircle" [size]="20"></lucide-icon>
                </div>
            </div>
        </div>

        <!-- Technical Details -->
        <div *ngIf="!isEditing" class="bg-slate-900 rounded-3xl p-8 border border-slate-800">
            <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                <lucide-icon [name]="ShieldAlert" [size]="20" class="text-blue-500"></lucide-icon>
                Detalles del Reporte
            </h3>

            <div class="space-y-4">
                <div class="flex justify-between py-3 border-b border-slate-800">
                    <span class="text-slate-400">Fecha de Inspección</span>
                    <span class="text-white font-medium">{{ checklist.fecha | date:'medium' }}</span>
                </div>
                <div class="flex justify-between py-3 border-b border-slate-800">
                    <span class="text-slate-400">Técnico Responsable</span>
                    <span class="text-white font-medium">{{ checklist.firmaTecnico || 'Pendiente' }}</span>
                </div>

                <!-- Firmar como... UI -->
                <div *ngIf="userRoleInStation !== 'none'" class="pt-4 border-t border-slate-800/30">
                    <div class="flex items-center justify-between gap-4">
                        <div class="bg-blue-500/10 p-4 rounded-2xl border border-blue-500/20 flex-1">
                            <div class="text-[10px] text-blue-400 font-black uppercase tracking-widest mb-1">Acción
                                Requerida</div>
                            <div class="text-xs text-slate-300">Usted está identificado como <b>Técnico {{
                                    userRoleInStation === 'local' ? 'Local' : 'Regional' }}</b> en esta estación.</div>
                        </div>
                        <button (click)="signAs(userRoleInStation === 'local' ? 'local' : 'regional')"
                            class="px-6 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold transition-all shadow-lg shadow-blue-600/20 flex items-center gap-2 whitespace-nowrap">
                            <lucide-icon [name]="Edit" [size]="18"></lucide-icon>
                            FIRMAR COMO TÉCNICO {{ userRoleInStation === 'local' ? 'LOCAL' : 'REGIONAL' }}
                        </button>
                    </div>
                </div>

                <div class="py-3">
                    <span class="text-slate-400 block mb-2">Observaciones</span>
                    <p class="text-slate-300 bg-slate-950 p-4 rounded-xl border border-slate-800 leading-relaxed">
                        {{ checklist.observaciones || 'Sin observaciones registradas.' }}
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- OFFICIAL PRINT FORM (Visible solo al imprimir) -->
<div *ngIf="checklist" class="hidden print:block p-0 bg-white text-black font-sans">
    <!-- Official Header -->
    <div class="mb-4 border-b-2 border-black pb-2">
        <div class="flex justify-between items-start">
            <div class="flex flex-col">
                <h1 class="text-3xl font-bold text-blue-600 tracking-tighter">
                    EANA <span class="text-slate-400 font-light text-xl">| NAVEGACIÓN</span>
                </h1>
                <h2 class="text-[10px] text-slate-600 tracking-[0.3em] font-black pl-1">AÉREA ARGENTINA</h2>
            </div>

            <div class="flex items-center gap-2">
                <div class="w-10 h-10 rounded-full border-2 border-sky-600 flex items-center justify-center p-1">
                    <div class="w-full h-full bg-yellow-400 rounded-full opacity-80"></div>
                </div>
                <div class="flex flex-col text-right">
                    <span class="text-[10px] font-bold">Ministerio de Transporte</span>
                    <span class="text-[10px] text-slate-600">Argentina</span>
                </div>
            </div>

            <div class="flex flex-col items-end">
                <h3 class="text-xs font-bold text-black">FOLIO Nº</h3>
                <div class="border border-black px-4 py-1 min-w-[60px] text-center font-bold text-red-600">
                    060
                </div>
            </div>
        </div>
    </div>

    <!-- Info Row -->
    <div class="grid grid-cols-2 gap-4 mb-4 text-sm font-bold border border-black p-2">
        <div>Estación: <span class="font-normal uppercase">{{ checklist.estacion }}</span></div>
        <div class="text-right">Fecha: <span class="font-normal">{{ checklist.fecha | date:'dd/MM/yyyy' }}</span></div>
    </div>

    <!-- Official Table -->
    <table class="w-full border-collapse border border-black text-xs">
        <thead>
            <tr class="bg-gray-100 uppercase">
                <th class="border border-black p-2 text-left w-2/3">Descripción de la Tarea</th>
                <th class="border border-black p-2 text-center w-24">Cumple</th>
                <th class="border border-black p-2 text-left">Observaciones</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="border border-black p-2 font-medium">Verificar conmutación de equipos principal /duplicado,
                    control local / remoto - telemetría / RCMS del equipamiento.</td>
                <td class="border border-black p-2 text-center font-bold">{{ mapToForm(checklist.tableroElectrico) }}
                </td>
                <td class="border border-black p-2"></td>
            </tr>
            <tr>
                <td class="border border-black p-2 font-medium">Verificar estado general de cargador y baterías.</td>
                <td class="border border-black p-2 text-center font-bold">{{ mapToForm(checklist.estadoBaterias ||
                    'cumple') }}</td>
                <td class="border border-black p-2"></td>
            </tr>
            <tr>
                <td class="border border-black p-2 font-medium">Verificación Sistema Irradiante VHF/UHF (Estado general
                    / Limpieza).</td>
                <td class="border border-black p-2 text-center font-bold">{{ mapToForm(checklist.sistemaIrradiante) }}
                </td>
                <td class="border border-black p-2"></td>
            </tr>
            <tr>
                <td class="border border-black p-2 font-medium">Verificar cableado, conectores y protectores gaseosos de
                    RF.</td>
                <td class="border border-black p-2 text-center font-bold">{{ mapToForm(checklist.cableadoRf) }}</td>
                <td class="border border-black p-2"></td>
            </tr>
            <tr>
                <td class="border border-black p-2 font-medium">Verificar balizamiento nocturno (baliza, fotocélula /
                    timer).</td>
                <td class="border border-black p-2 text-center font-bold">{{ mapToForm(checklist.balizamiento) }}</td>
                <td class="border border-black p-2"></td>
            </tr>
            <tr>
                <td class="border border-black p-2 font-medium">Verificar switch/s.</td>
                <td class="border border-black p-2 text-center font-bold">{{ mapToForm(checklist.switchEthernet ||
                    'cumple') }}</td>
                <td class="border border-black p-2"></td>
            </tr>
            <tr>
                <td class="border border-black p-2 font-medium">Verificar cabeza de control y micrófono dinámico
                    (funcionamiento, conexionado)</td>
                <td class="border border-black p-2 text-center font-bold">{{ mapToForm(checklist.cabezaControl) }}</td>
                <td class="border border-black p-2"></td>
            </tr>
            <tr>
                <td class="border border-black p-2 font-medium">Limpieza del equipamiento externo e interno en general.
                </td>
                <td class="border border-black p-2 text-center font-bold">{{ mapToForm(checklist.limpieza) }}</td>
                <td class="border border-black p-2"></td>
            </tr>

            <!-- Tensión Row -->
            <tr class="bg-gray-50/30">
                <td class="border border-black p-2 font-medium">Medición tensión de cargador y tensión de baterías
                    (cortando energía comercial)</td>
                <td class="border border-black p-2 text-center">---</td>
                <td class="border border-black p-2 text-[10px]">
                    <div class="flex flex-col">
                        <span>V rectificador: <b>{{ checklist.vRectificador }}</b></span>
                        <span>V luego de 1 hora: <b>{{ checklist.v1hora }}</b></span>
                    </div>
                </td>
            </tr>

            <!-- Measurements Section Title -->
            <tr class="bg-gray-100 font-bold uppercase">
                <th class="border border-black p-2 text-left">DESCRIPCIÓN</th>
                <th class="border border-black p-2 text-center">VALOR MEDIDO</th>
                <th class="border border-black p-2 text-left">OBSERVACIONES</th>
            </tr>

            <!-- Modulación -->
            <tr>
                <td class="border border-black p-2 font-medium">Medición de profundidad de modulación.</td>
                <td class="border border-black p-2 text-center font-bold">---</td>
                <td class="border border-black p-2 font-bold">{{ checklist.modulacionObs }}</td>
            </tr>

            <!-- ROE -->
            <tr>
                <td class="border border-black p-2 font-medium">Medición del ROE con instrumento local (local) e
                    instrumental externo.</td>
                <td class="border border-black p-2 p-0">
                    <div class="grid grid-cols-2 divide-x divide-black h-full">
                        <div class="p-2 text-center font-bold">{{ checklist.roeLocal }}</div>
                        <div class="p-2 text-center font-bold">{{ checklist.roeExterno }}</div>
                    </div>
                </td>
                <td class="border border-black p-2"></td>
            </tr>

            <!-- Potencia -->
            <tr>
                <td class="border border-black p-2 font-medium">Medición de potencia de salida con instrumento local
                    (Watt) e Instrumental externo (Watt).</td>
                <td class="border border-black p-2 p-0">
                    <div class="grid grid-cols-2 divide-x divide-black h-full">
                        <div class="p-2 text-center font-bold">{{ checklist.potenciaLocal }}</div>
                        <div class="p-2 text-center font-bold">{{ checklist.potenciaExterno }}</div>
                    </div>
                </td>
                <td class="border border-black p-2"></td>
            </tr>

            <!-- Piso de Ruido -->
            <tr>
                <td class="border border-black p-2 font-medium">Nivel piso de ruido.</td>
                <td class="border border-black p-2 text-center font-bold">---</td>
                <td class="border border-black p-2 font-bold">{{ checklist.pisoRuidoObs }}</td>
            </tr>

            <!-- Squelch -->
            <tr>
                <td class="border border-black p-2 font-medium">Nivel de squelch.</td>
                <td class="border border-black p-2 text-center font-bold">---</td>
                <td class="border border-black p-2 font-bold">{{ checklist.squelchObs }}</td>
            </tr>

            <!-- Puesta a Tierra -->
            <tr>
                <td class="border border-black p-2 font-medium">Medición con telurímetro y verificación de la puesta a
                    tierra.</td>
                <td class="border border-black p-2 text-center">---</td>
                <td class="border border-black p-2 font-bold">{{ checklist.puestaTierra }}</td>
            </tr>

            <!-- Dias Sin Alternancia -->
            <tr>
                <td class="border border-black p-2 font-medium">Días sin alternancia.</td>
                <td class="border border-black p-2 text-center">---</td>
                <td class="border border-black p-2 font-bold">{{ checklist.diasSinAlternancia }}</td>
            </tr>

            <!-- Estado Final -->
            <tr class="bg-gray-50">
                <td class="border border-black p-2 font-bold">Estado General del Sistema</td>
                <td colspan="2" class="border border-black p-2 font-bold text-center uppercase"
                    [ngClass]="{'text-red-600': checklist.estado === 'FALLA', 'text-amber-600': checklist.estado === 'PRECAUCION'}">
                    {{ checklist.estado }}
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Signatures -->
    <div class="mt-32 grid grid-cols-2 gap-20"> <!-- mt-32 para dar más espacio -->
        <div class="border-t border-black text-center pt-2 relative">
            <div class="absolute -top-10 left-0 right-0 text-center font-script text-xl text-blue-900"
                *ngIf="checklist.firmaRegional">
                {{ checklist.firmaRegional }}
            </div>
            <div class="h-20" *ngIf="!checklist.firmaRegional"></div>
            <p class="text-[10px] font-bold uppercase">Nombre y Firma Técnico CNSE Regional</p>
            <p class="text-[8px] text-gray-500" *ngIf="checklist.firmaRegional">Firmado digitalmente</p>
        </div>
        <div class="border-t border-black text-center pt-2 relative">
            <div class="absolute -top-10 left-0 right-0 text-center font-script text-xl text-blue-900"
                *ngIf="checklist.firmaLocal">
                {{ checklist.firmaLocal }}
            </div>
            <div class="h-20" *ngIf="!checklist.firmaLocal"></div>
            <p class="text-[10px] font-bold uppercase">Nombre y Firma Técnico CNSE Local</p>
            <p class="text-[8px] text-gray-500" *ngIf="checklist.firmaLocal">Firmado digitalmente</p>
        </div>
    </div>

    <!-- Official Footer -->
    <div class="fixed bottom-4 left-0 right-0 text-center text-[8px] text-gray-400">
        EANA S.E. - Formulario de Mantenimiento Preventivo VHF - Ver. 2.0
    </div>
</div>

<!-- Loading State -->
<div *ngIf="loading" class="flex items-center justify-center min-h-[50vh]">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
</div>