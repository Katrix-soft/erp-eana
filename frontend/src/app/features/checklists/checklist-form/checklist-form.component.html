<!-- VIEW / CREATE MODE (Legacy / Full Form) -->
<div
    [ngClass]="{'p-4 md:p-8 max-w-5xl mx-auto print:p-0': true, 'hidden': mode === 'edit', 'block': mode !== 'edit', 'print:block': true}">
    <!-- Header Actions -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6 print:hidden">
        <button (click)="router.navigate(['/checklists'])"
            class="flex items-center gap-2 text-slate-400 hover:text-white transition-colors self-start">
            <lucide-icon [name]="ArrowLeft" [size]="20"></lucide-icon>
            <span class="font-medium">Volver</span>
        </button>
        <h1 class="text-2xl font-bold text-white text-center md:text-left">
            {{ mode === 'view' ? 'Ver Checklist' : 'Nuevo Checklist' }}
        </h1>
        <div class="flex items-center gap-2 self-end md:self-auto">
            <button *ngIf="isView" [routerLink]="['/checklists', id, 'edit']"
                class="flex items-center gap-2 text-amber-400 hover:text-amber-300 mr-2">
                <lucide-icon [name]="Edit" [size]="20"></lucide-icon> Editar / Firmar
            </button>
            <button (click)="print()"
                class="flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-all active:scale-95">
                <lucide-icon [name]="Printer" [size]="20"></lucide-icon> Imprimir
            </button>
        </div>
    </div>

    <!-- Official Header -->
    <div class="mb-6 border-b-2 border-slate-800 pb-4 print:border-black print:pb-2">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-4">
            <div class="flex flex-col">
                <h1 class="text-2xl md:text-3xl font-bold text-blue-500 tracking-tighter print:text-blue-600">
                    EANA <span class="text-slate-400 font-light text-lg md:text-xl print:text-slate-400">|
                        NAVEGACIÓN</span>
                </h1>
                <h2 class="text-xs text-slate-500 tracking-widest pl-1">AÉREA ARGENTINA</h2>
            </div>

            <div class="flex items-center gap-2">
                <div
                    class="w-10 h-10 rounded-full bg-sky-900/50 flex items-center justify-center border-2 border-sky-500 print:bg-white print:border-sky-600">
                    <div class="w-6 h-6 bg-yellow-400 rounded-full opacity-80"></div>
                </div>
                <div class="flex flex-col text-right">
                    <span class="text-xs font-bold text-slate-300 print:text-slate-700">Ministerio de Transporte</span>
                    <span class="text-xs text-slate-500">Argentina</span>
                </div>
            </div>

            <form [formGroup]="form" class="w-full md:w-auto">
                <div
                    class="flex flex-row md:flex-col items-center md:items-end justify-between md:justify-center bg-slate-900/30 p-2 md:p-0 rounded-lg md:bg-transparent">
                    <h3 class="text-xs font-bold text-slate-300 print:text-slate-800 mr-4 md:mr-0">FOLIO Nº</h3>
                    <div
                        class="border border-slate-700 px-2 py-1 min-w-[100px] md:min-w-[60px] text-center font-bold text-red-500 bg-slate-900 print:bg-white print:text-red-600 print:border-black rounded md:rounded-none">
                        <input formControlName="folio"
                            class="w-full text-center bg-transparent border-none outline-none text-red-500 font-bold p-0" />
                    </div>
                </div>
            </form>
        </div>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">

        <!-- Mobile Main Items (Show only on small screens) -->
        <div class="md:hidden space-y-4 mb-6">
            <div *ngFor="let item of mainItems" class="bg-slate-900 border border-slate-800 rounded-xl p-4 shadow-sm">
                <label class="block text-xs font-black text-blue-400 mb-3 uppercase tracking-widest">{{ item.label
                    }}</label>
                <div class="flex flex-col gap-3">
                    <div class="relative">
                        <select [formControlName]="item.name"
                            class="w-full p-3 bg-slate-950 border border-slate-800 rounded-lg text-white text-sm appearance-none outline-none focus:ring-2 focus:ring-blue-500/50 transition-all">
                            <option value="">TAREA REALIZADA (SI/NO)</option>
                            <option value="SI">CUMPLE (SI)</option>
                            <option value="NO">NO CUMPLE (NO)</option>
                        </select>
                        <div class="absolute inset-y-0 right-3 flex items-center pointer-events-none text-slate-500">
                            <lucide-icon [name]="ChevronDown" [size]="16"></lucide-icon>
                        </div>
                    </div>
                    <textarea [formControlName]="item.name + '_obs'" rows="2"
                        class="w-full p-3 bg-slate-950/50 border border-slate-800 rounded-lg text-sm text-slate-300 placeholder-slate-600 focus:ring-2 focus:ring-blue-500/20 outline-none transition-all"
                        placeholder="Observaciones..."></textarea>
                </div>
            </div>

            <!-- Tensión Mobile -->
            <div class="bg-slate-900 border border-slate-800 rounded-xl p-4 shadow-sm">
                <label class="block text-xs font-black text-blue-400 mb-3 uppercase tracking-widest">
                    Tensión de Cargador y Baterías
                </label>
                <div class="space-y-4">
                    <div
                        class="flex items-center justify-between gap-4 p-3 bg-slate-950/50 rounded-lg border border-slate-800/50">
                        <span class="text-xs font-medium text-slate-400">V salida rectificador:</span>
                        <input formControlName="v_rectificador"
                            class="w-24 p-2 text-right bg-slate-900 border border-slate-700 rounded text-sm text-white font-bold" />
                    </div>
                    <div
                        class="flex items-center justify-between gap-4 p-3 bg-slate-950/50 rounded-lg border border-slate-800/50">
                        <span class="text-xs font-medium text-slate-400">V luego de 1 hora:</span>
                        <input formControlName="v_1hora"
                            class="w-24 p-2 text-right bg-slate-900 border border-slate-700 rounded text-sm text-white font-bold" />
                    </div>
                </div>
            </div>
        </div>
        <!-- Desktop Table -->
        <div
            class="hidden md:block bg-slate-900 border border-slate-800 overflow-hidden shadow-sm print:block print:bg-white print:border-black print:shadow-none">
            <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-slate-950 border-b border-slate-800 print:bg-slate-100 print:border-black">
                        <th
                            class="p-4 text-left text-xs font-black text-slate-400 uppercase tracking-[0.15em] border-r border-slate-800 print:text-black print:border-black">
                            DESCRIPCIÓN</th>
                        <th
                            class="p-4 text-center text-xs font-black text-slate-400 uppercase tracking-[0.15em] w-48 border-r border-slate-800 print:text-black print:border-black">
                            TAREA REALIZADA</th>
                        <th
                            class="p-4 text-center text-xs font-black text-slate-400 uppercase tracking-[0.15em] print:text-black">
                            OBSERVACIONES</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-800 print:divide-black">
                    <tr *ngFor="let item of mainItems"
                        class="border-b border-slate-800 hover:bg-slate-800/50 transition-colors print:border-black">
                        <td
                            class="p-2 text-sm text-slate-300 border-r border-slate-800 print:text-black print:border-black">
                            {{ item.label }}</td>
                        <td class="p-1 text-center border-r border-slate-800 w-48 align-middle print:border-black">
                            <select [formControlName]="item.name"
                                class="w-full p-2.5 border border-slate-700 bg-slate-950 rounded-lg text-sm text-white font-bold focus:ring-2 focus:ring-blue-500/50 outline-none print:border-none print:bg-transparent print:text-black">
                                <option value="">-</option>
                                <option value="SI" class="text-emerald-500 font-bold">SI (CUMPLE)</option>
                                <option value="NO" class="text-red-500 font-bold">NO (NO CUMPLE)</option>
                            </select>
                        </td>
                        <td class="p-1 align-middle">
                            <textarea [formControlName]="item.name + '_obs'" rows="1"
                                class="w-full h-full p-1 border-none bg-transparent text-sm focus:ring-0 outline-none resize-none overflow-hidden font-bold text-white print:text-black"
                                placeholder=""></textarea>
                        </td>
                    </tr>

                    <!-- Tensión Row -->
                    <tr class="border-b border-slate-800 hover:bg-slate-800/50 print:border-black">
                        <td
                            class="p-2 text-sm text-slate-300 border-r border-slate-800 print:text-black print:border-black">
                            Medición tensión de cargador y tensión de baterías (cortando energía comercial)
                        </td>
                        <td class="p-2 border-r border-slate-800 bg-slate-950/50 print:bg-slate-100 print:border-black">
                        </td>
                        <td class="p-2">
                            <div class="flex flex-col gap-1">
                                <div class="flex items-center gap-1">
                                    <span class="text-xs font-bold whitespace-nowrap text-slate-400 print:text-black">V
                                        en salida rectificador:</span>
                                    <input formControlName="v_rectificador"
                                        class="w-20 p-0 text-xs border-b border-slate-600 bg-transparent focus:ring-0 font-bold text-white print:text-black print:border-none" />
                                </div>
                                <div class="flex items-center gap-1">
                                    <span class="text-xs font-bold whitespace-nowrap text-slate-400 print:text-black">V
                                        luego de 1 hora:</span>
                                    <input formControlName="v_1hora"
                                        class="w-20 p-0 text-xs border-b border-slate-600 bg-transparent focus:ring-0 font-bold text-white print:text-black print:border-none" />
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Mobile Measurements (Show only on small screens) -->
        <div class="md:hidden space-y-4 mb-6">
            <h3 class="text-sm font-black text-slate-500 uppercase tracking-[0.2em] px-1">Mediciones Técnicas</h3>

            <!-- Modulación Mobile -->
            <div class="bg-slate-900 border border-slate-800 rounded-xl p-4 shadow-sm">
                <label class="block text-xs font-black text-blue-400 mb-3 uppercase tracking-widest">Modulación</label>
                <div class="flex gap-4">
                    <div class="w-1/3">
                        <span class="block text-[10px] text-slate-500 mb-1">VALOR %</span>
                        <input formControlName="modulacion"
                            class="w-full p-3 bg-slate-950 border border-slate-800 rounded-lg text-white font-bold text-center" />
                    </div>
                    <div class="flex-1">
                        <span class="block text-[10px] text-slate-500 mb-1">OBSERVACIONES</span>
                        <input formControlName="modulacion_obs"
                            class="w-full p-3 bg-slate-950 border border-slate-800 rounded-lg text-white text-sm" />
                    </div>
                </div>
            </div>

            <!-- ROE Mobile -->
            <div class="bg-slate-900 border border-slate-800 rounded-xl p-4 shadow-sm">
                <label class="block text-xs font-black text-blue-400 mb-3 uppercase tracking-widest">Medición
                    ROE</label>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <span class="block text-[10px] text-slate-500 mb-1">LOCAL</span>
                        <input formControlName="roe_local"
                            class="w-full p-3 bg-slate-950 border border-slate-800 rounded-lg text-white font-bold text-center" />
                    </div>
                    <div>
                        <span class="block text-[10px] text-slate-500 mb-1">EXTERNO</span>
                        <input formControlName="roe_externo"
                            class="w-full p-3 bg-slate-950 border border-slate-800 rounded-lg text-white font-bold text-center" />
                    </div>
                </div>
            </div>

            <!-- Potencia Mobile -->
            <div class="bg-slate-900 border border-slate-800 rounded-xl p-4 shadow-sm">
                <label class="block text-xs font-black text-blue-400 mb-3 uppercase tracking-widest">Potencia
                    (W)</label>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <span class="block text-[10px] text-slate-500 mb-1">LOCAL</span>
                        <input formControlName="potencia_local"
                            class="w-full p-3 bg-slate-950 border border-slate-800 rounded-lg text-white font-bold text-center" />
                    </div>
                    <div>
                        <span class="block text-[10px] text-slate-500 mb-1">EXTERNO</span>
                        <input formControlName="potencia_externo"
                            class="w-full p-3 bg-slate-950 border border-slate-800 rounded-lg text-white font-bold text-center" />
                    </div>
                </div>
            </div>

            <!-- Otros: Noise, Squelch, Tierra -->
            <div class="bg-slate-900 border border-slate-800 rounded-xl p-4 shadow-sm space-y-4">
                <div class="flex items-center justify-between gap-4">
                    <span class="text-xs font-bold text-slate-400">Piso DE RUIDO (dBm):</span>
                    <input formControlName="piso_ruido"
                        class="w-24 p-2 text-center bg-slate-950 border border-slate-700 rounded text-sm text-white font-bold" />
                </div>
                <div class="flex items-center justify-between gap-4">
                    <span class="text-xs font-bold text-slate-400">SQUELCH (dBm):</span>
                    <input formControlName="squelch"
                        class="w-24 p-2 text-center bg-slate-950 border border-slate-700 rounded text-sm text-white font-bold" />
                </div>
                <div class="flex items-center justify-between gap-4">
                    <span class="text-xs font-bold text-slate-400">PUESTA A TIERRA (Ω):</span>
                    <input formControlName="puesta_tierra"
                        class="w-24 p-2 text-center bg-slate-950 border border-slate-700 rounded text-sm text-white font-bold" />
                </div>
                <div class="flex items-center justify-between gap-4">
                    <span class="text-xs font-bold text-slate-400">DÍAS SIN ALTERNANCIA:</span>
                    <input formControlName="dias_sin_alternancia"
                        class="w-24 p-2 text-center bg-slate-950 border border-slate-700 rounded text-sm text-white font-bold" />
                </div>
            </div>
        </div>

        <!-- Measurements Table -->
        <div
            class="hidden md:block bg-slate-900 border border-slate-800 overflow-hidden shadow-sm print:block print:bg-white print:border-black print:shadow-none border-t-0 rounded-t-none">
            <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-slate-950 border-b border-slate-800 print:bg-slate-100 print:border-black">
                        <th
                            class="p-2 text-center text-xs font-bold text-slate-400 uppercase tracking-wider w-auto border-r border-slate-800 print:text-black print:border-black">
                            DESCRIPCIÓN</th>
                        <th
                            class="p-2 text-center text-xs font-bold text-slate-400 uppercase tracking-wider w-40 border-r border-slate-800 print:text-black print:border-black">
                            VALOR<br />MEDIDO</th>
                        <th
                            class="p-2 text-center text-xs font-bold text-slate-400 uppercase tracking-wider print:text-black">
                            OBSERVACIONES</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Modulación -->
                    <tr class="border-b border-slate-800 print:border-black">
                        <td
                            class="p-2 text-sm text-slate-300 border-r border-slate-800 print:text-black print:border-black">
                            Medición de profundidad de modulación.</td>
                        <td class="p-1 border-r border-slate-800 bg-slate-950/50 print:bg-slate-100 print:border-black">
                            <input formControlName="modulacion" placeholder="%"
                                class="w-full text-center bg-transparent border-none font-bold p-0 text-white print:text-black" />
                        </td>
                        <td class="p-2 font-bold text-sm text-slate-300 print:text-black">
                            <input formControlName="modulacion_obs"
                                class="w-full bg-transparent border-none font-bold text-white print:text-black" />
                        </td>
                    </tr>

                    <!-- ROE -->
                    <tr class="border-b border-slate-800 print:border-black">
                        <td
                            class="p-2 text-sm text-slate-300 border-r border-slate-800 print:text-black print:border-black">
                            Medición del ROE con instrumento local (local) e instrumental externo.</td>
                        <td class="p-0 border-r border-slate-800 print:border-black">
                            <div class="grid grid-cols-2 h-full divide-x divide-slate-800 print:divide-black">
                                <div class="p-2 text-center font-bold flex items-center justify-center">
                                    <input formControlName="roe_local"
                                        class="w-full text-center bg-transparent border-none font-bold p-0 text-white print:text-black" />
                                </div>
                                <div class="p-2 text-center font-bold flex items-center justify-center">
                                    <input formControlName="roe_externo"
                                        class="w-full text-center bg-transparent border-none font-bold p-0 text-white print:text-black" />
                                </div>
                            </div>
                        </td>
                        <td class="p-2"></td>
                    </tr>

                    <!-- Potencia -->
                    <tr class="border-b border-slate-800 print:border-black">
                        <td
                            class="p-2 text-sm text-slate-300 border-r border-slate-800 print:text-black print:border-black">
                            Medición de potencia de salida con instrumento local (Watt) e Instrumental externo (Watt).
                        </td>
                        <td class="p-0 border-r border-slate-800 print:border-black">
                            <div class="grid grid-cols-2 h-full divide-x divide-slate-800 print:divide-black">
                                <div class="p-2 text-center font-bold flex items-center justify-center">
                                    <input formControlName="potencia_local"
                                        class="w-full text-center bg-transparent border-none font-bold p-0 text-white print:text-black" />
                                </div>
                                <div class="p-2 text-center font-bold flex items-center justify-center">
                                    <input formControlName="potencia_externo"
                                        class="w-full text-center bg-transparent border-none font-bold p-0 text-white print:text-black" />
                                </div>
                            </div>
                        </td>
                        <td class="p-2"></td>
                    </tr>

                    <!-- Piso de Ruido -->
                    <tr class="border-b border-slate-800 print:border-black">
                        <td
                            class="p-2 text-sm text-slate-300 border-r border-slate-800 print:text-black print:border-black">
                            Nivel piso de ruido.</td>
                        <td class="p-1 border-r border-slate-800 bg-slate-950/50 print:bg-slate-100 print:border-black">
                            <input formControlName="piso_ruido" placeholder="dBm"
                                class="w-full text-center bg-transparent border-none font-bold p-0 text-white print:text-black" />
                        </td>
                        <td class="p-2 font-bold text-sm text-slate-300 print:text-black">
                            <input formControlName="piso_ruido_obs"
                                class="w-full bg-transparent border-none font-bold text-white print:text-black" />
                        </td>
                    </tr>

                    <!-- Squelch -->
                    <tr class="border-b border-slate-800 print:border-black">
                        <td
                            class="p-2 text-sm text-slate-300 border-r border-slate-800 print:text-black print:border-black">
                            Nivel de squelch.</td>
                        <td class="p-1 border-r border-slate-800 bg-slate-950/50 print:bg-slate-100 print:border-black">
                            <input formControlName="squelch" placeholder="dBm"
                                class="w-full text-center bg-transparent border-none font-bold p-0 text-white print:text-black" />
                        </td>
                        <td class="p-2 font-bold text-sm text-slate-300 print:text-black">
                            <input formControlName="squelch_obs"
                                class="w-full bg-transparent border-none font-bold text-white print:text-black" />
                        </td>
                    </tr>

                    <!-- Puesta a Tierra -->
                    <tr class="border-b border-slate-800 print:border-black">
                        <td
                            class="p-2 text-sm text-slate-300 border-r border-slate-800 print:text-black print:border-black">
                            Medición con telurímetro y verificación de la puesta a tierra.</td>
                        <td class="p-1 border-r border-slate-800 bg-slate-950/50 print:bg-slate-100 print:border-black">
                            <input formControlName="puesta_tierra" placeholder="Ω"
                                class="w-full text-center bg-transparent border-none font-bold p-0 text-white print:text-black" />
                        </td>
                        <td class="p-2">
                        </td>
                    </tr>

                    <!-- Dias Sin Alternancia -->
                    <tr>
                        <td
                            class="p-2 text-sm text-slate-300 border-r border-slate-800 print:text-black print:border-black">
                            Días sin alternancia.</td>
                        <td class="p-1 border-r border-slate-800 bg-slate-950/50 print:bg-slate-100 print:border-black">
                            <input formControlName="dias_sin_alternancia"
                                class="w-full text-center bg-transparent border-none font-bold p-0 text-white print:text-black" />
                        </td>
                        <td class="p-2 font-bold text-sm text-slate-300 print:text-black">
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Firma Tecnico Regional -->
        <div class="border-t border-slate-400 pt-4 text-center group">
            <div *ngIf="form.value.firma_digital_regional; else signRegional" class="text-center">
                <div class="inline-block p-2 bg-blue-50 border border-blue-200 rounded mb-2">
                    <p class="font-serif text-2xl text-blue-900 leading-none">{{ form.value.firma_digital_regional }}
                    </p>
                    <p class="text-[8px] text-blue-400 uppercase tracking-tighter mt-1">Firma Digital Verificada</p>
                </div>
                <p class="text-xs text-slate-500">{{ (form.value.fechaFirmaTecnico || now) | date:'short' }}</p>
                <p class="text-sm font-bold text-slate-700 mt-2">Técnico CNSE Regional</p>
            </div>
            <ng-template #signRegional>
                <div class="flex flex-col items-center gap-3 print:hidden">
                    <p class="text-sm font-bold text-slate-400 mb-2">Firma Digital Regional</p>
                    <ng-container
                        *ngIf="!isView && ((user$ | async)?.role === 'TECNICO' || (user$ | async)?.role === 'ADMIN')">
                        <select
                            class="w-full max-w-xs p-2 bg-slate-800 border-slate-700 rounded-lg text-sm text-white border hover:border-blue-500 transition-colors"
                            (change)="handleSign('REGIONAL', $any($event.target).value); handleSign('TECNICO', $any($event.target).value)">
                            <option value="">Seleccionar Firmante Regional...</option>
                            <option *ngFor="let u of regionalUsers" [value]="u.nombre + ' ' + u.apellido">
                                {{ u.nombre }} {{ u.apellido }} ({{ u.firNombre || 'REGIONAL' }})
                            </option>
                        </select>
                    </ng-container>
                    <p *ngIf="isView" class="text-sm text-slate-500 italic">Pendiente de firma regional</p>
                </div>
                <div class="hidden print:block h-16 border-b border-black w-full mb-2"></div>
                <p class="hidden print:block text-sm font-bold text-black mt-2">Firma Técnico CNSE Regional</p>
            </ng-template>
        </div>

        <!-- Firma Tecnico Local -->
        <div class="border-t border-slate-400 pt-4 text-center group">
            <div *ngIf="form.value.firma_digital_local; else signLocal" class="text-center">
                <div class="inline-block p-2 bg-emerald-50 border border-emerald-200 rounded mb-2">
                    <p class="font-serif text-2xl text-emerald-900 leading-none">{{ form.value.firma_digital_local }}
                    </p>
                    <p class="text-[8px] text-emerald-400 uppercase tracking-tighter mt-1">Firma Digital Verificada</p>
                </div>
                <p class="text-xs text-slate-500">{{ (form.value.fechaFirmaCoordinador || now) | date:'short' }}</p>
                <p class="text-sm font-bold text-slate-700 mt-2">Técnico CNSE Local</p>
            </div>
            <ng-template #signLocal>
                <div class="flex flex-col items-center gap-3 print:hidden">
                    <p class="text-sm font-bold text-slate-400 mb-2">Firma Digital Local</p>
                    <ng-container
                        *ngIf="!isView && ((user$ | async)?.role === 'JEFE_COORDINADOR' || (user$ | async)?.role === 'CNS_NACIONAL' || (user$ | async)?.role === 'ADMIN')">
                        <select
                            class="w-full max-w-xs p-2 bg-slate-800 border-slate-700 rounded-lg text-sm text-white border hover:border-emerald-500 transition-colors"
                            (change)="handleSign('LOCAL', $any($event.target).value); handleSign('COORDINADOR', $any($event.target).value)">
                            <option value="">Seleccionar Firmante Local...</option>
                            <option *ngFor="let u of localUsers" [value]="u.nombre + ' ' + u.apellido">
                                {{ u.nombre }} {{ u.apellido }} ({{ u.aeropuertoCodigo || 'LOCAL' }})
                            </option>
                        </select>
                    </ng-container>
                    <p *ngIf="isView" class="text-sm text-slate-500 italic">Pendiente de firma local</p>
                </div>
                <div class="hidden print:block h-16 border-b border-black w-full mb-2"></div>
                <p class="hidden print:block text-sm font-bold text-black mt-2">Firma Técnico CNSE Local</p>
            </ng-template>
        </div>

        <!-- Footer Actions (Relative to form content) -->
        <div *ngIf="!isView"
            class="mt-12 p-6 bg-slate-900 border border-slate-800 rounded-2xl flex flex-col md:flex-row items-center justify-end gap-4 shadow-xl print:hidden">
            <button type="button" routerLink="/checklists"
                class="w-full md:w-auto px-6 py-3 text-slate-400 hover:text-white hover:bg-white/5 rounded-xl transition-all font-bold text-sm tracking-widest uppercase">Cancelar</button>
            <button type="submit" [disabled]="loading"
                class="w-full md:w-auto px-10 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-500 flex items-center justify-center gap-3 shadow-lg shadow-blue-600/20 transition-all font-black text-sm tracking-widest uppercase active:scale-[0.98]">
                <lucide-icon [name]="Save" [size]="18"></lucide-icon>
                {{ loading ? 'Guardando...' : 'Guardar Checklist' }}
            </button>
        </div>
    </form>
</div>

<!-- EDIT MODE (Simplified Status Updater) -->
<div *ngIf="mode === 'edit'" class="min-h-screen bg-slate-950 p-4 md:p-8 animate-in fade-in duration-500 print:hidden">
    <div class="max-w-4xl mx-auto space-y-8">

        <!-- Header -->
        <div class="flex items-center justify-between">
            <button routerLink="/checklists"
                class="flex items-center gap-2 text-slate-400 hover:text-white transition-colors group">
                <lucide-icon [name]="ArrowLeft" [size]="20"
                    class="group-hover:-translate-x-1 transition-transform"></lucide-icon>
                <span class="font-bold tracking-wide text-sm">VOLVER</span>
            </button>

            <div class="flex items-center gap-4">
                <button (click)="router.navigate(['/checklists'])"
                    class="px-4 py-2 text-xs font-bold text-slate-500 hover:text-white transition-colors border border-slate-800 rounded-lg uppercase tracking-wider">
                    Cancelar
                </button>
                <button (click)="print()"
                    class="flex items-center gap-2 px-4 py-2 text-xs font-bold text-slate-400 hover:text-white transition-colors border border-slate-800 rounded-lg uppercase tracking-wider hover:bg-slate-900">
                    <lucide-icon [name]="Printer" [size]="16"></lucide-icon>
                    Imprimir
                </button>
                <div class="text-right ml-4">
                    <span class="block text-[10px] font-black text-slate-600 uppercase tracking-widest leading-none">ID
                        REPORTE</span>
                    <span class="block text-xl font-black text-white leading-none">#{{ id }}</span>
                </div>
            </div>
        </div>

        <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-8">

            <!-- Status Selectors -->
            <div
                class="grid grid-cols-1 md:grid-cols-3 gap-4 p-1.5 bg-slate-900/50 rounded-2xl border border-slate-800">

                <!-- OPERATIVO -->
                <label class="cursor-pointer relative group">
                    <input type="radio" formControlName="estado" value="OPERATIVO" class="peer sr-only">
                    <div
                        class="h-16 flex items-center justify-center gap-3 rounded-xl border border-transparent bg-slate-900 text-slate-500 transition-all duration-300 peer-checked:bg-emerald-500/10 peer-checked:border-emerald-500 peer-checked:text-emerald-500 peer-checked:shadow-[0_0_20px_rgba(16,185,129,0.2)] hover:bg-slate-800">
                        <div
                            class="w-3 h-3 rounded-full bg-emerald-500 shadow-[0_0_10px_currentColor] opacity-0 peer-checked:opacity-100 transition-opacity">
                        </div>
                        <span class="font-black text-xs uppercase tracking-widest">Poner en Servicio</span>
                    </div>
                </label>

                <!-- PRECAUCION -->
                <label class="cursor-pointer relative group">
                    <input type="radio" formControlName="estado" value="PRECAUCION" class="peer sr-only">
                    <div
                        class="h-16 flex items-center justify-center gap-3 rounded-xl border border-transparent bg-slate-900 text-slate-500 transition-all duration-300 peer-checked:bg-amber-500/10 peer-checked:border-amber-500 peer-checked:text-amber-500 peer-checked:shadow-[0_0_20px_rgba(245,158,11,0.2)] hover:bg-slate-800">
                        <div
                            class="w-3 h-3 rounded-full bg-amber-500 shadow-[0_0_10px_currentColor] opacity-0 peer-checked:opacity-100 transition-opacity">
                        </div>
                        <span class="font-black text-xs uppercase tracking-widest">Modo Precaución</span>
                        <lucide-icon *ngIf="form.get('estado')?.value === 'PRECAUCION'" [name]="'AlertTriangle'"
                            [size]="16"></lucide-icon>
                    </div>
                </label>

                <!-- FALLA -->
                <label class="cursor-pointer relative group">
                    <input type="radio" formControlName="estado" value="FALLA" class="peer sr-only">
                    <div
                        class="h-16 flex items-center justify-center gap-3 rounded-xl border border-transparent bg-slate-900 text-slate-500 transition-all duration-300 peer-checked:bg-red-500/10 peer-checked:border-red-500 peer-checked:text-red-500 peer-checked:shadow-[0_0_20px_rgba(239,68,68,0.2)] hover:bg-slate-800">
                        <div
                            class="w-3 h-3 rounded-full bg-red-500 shadow-[0_0_10px_currentColor] opacity-0 peer-checked:opacity-100 transition-opacity">
                        </div>
                        <span class="font-black text-xs uppercase tracking-widest">Sacar de Servicio</span>
                    </div>
                </label>

            </div>

            <!-- Editor Card -->
            <div class="bg-slate-900 border border-slate-800 rounded-3xl p-8 shadow-2xl relative overflow-hidden">
                <!-- Decorative Glow -->
                <div
                    class="absolute top-0 right-0 w-64 h-64 bg-blue-600/5 rounded-full blur-[100px] pointer-events-none">
                </div>

                <div class="flex items-center gap-3 mb-6 relative z-10">
                    <div class="p-2 bg-blue-600 rounded-lg text-white shadow-lg shadow-blue-600/30">
                        <lucide-icon [name]="Edit" [size]="20"></lucide-icon>
                    </div>
                    <h2 class="text-xl font-bold text-white tracking-tight">Editar Checklist</h2>
                </div>

                <!-- Checklist Items (Modern Steps) -->
                <div class="mb-8 relative z-10">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="p-1.5 bg-slate-800 rounded-lg text-slate-400">
                            <lucide-icon [name]="'ListChecks'" [size]="16"></lucide-icon>
                        </div>
                        <h3 class="text-sm font-bold text-slate-300 uppercase tracking-widest">Items de verificación
                        </h3>
                    </div>

                    <app-checklist-steps [form]="form"></app-checklist-steps>
                </div>

                <!-- Measurements Grid -->
                <div class="mb-8 relative z-10 pt-8 border-t border-slate-800/50">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="p-1.5 bg-slate-800 rounded-lg text-slate-400">
                            <lucide-icon [name]="'Activity'" [size]="16"></lucide-icon>
                        </div>
                        <h3 class="text-sm font-bold text-slate-300 uppercase tracking-widest">Mediciones Técnicas</h3>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Potencia -->
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1">Potencia
                                (W)</label>
                            <div class="grid grid-cols-2 gap-2">
                                <input formControlName="potencia_local" placeholder="Local"
                                    class="w-full bg-slate-950/50 border border-slate-800 hover:border-slate-700 focus:border-blue-500/50 rounded-xl px-4 py-3 text-white font-mono font-bold placeholder-slate-700 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all text-sm" />
                                <input formControlName="potencia_externo" placeholder="Externo"
                                    class="w-full bg-slate-950/50 border border-slate-800 hover:border-slate-700 focus:border-blue-500/50 rounded-xl px-4 py-3 text-white font-mono font-bold placeholder-slate-700 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all text-sm" />
                            </div>
                        </div>

                        <!-- ROE -->
                        <div class="space-y-2">
                            <label
                                class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1">ROE</label>
                            <div class="grid grid-cols-2 gap-2">
                                <input formControlName="roe_local" placeholder="Local"
                                    class="w-full bg-slate-950/50 border border-slate-800 hover:border-slate-700 focus:border-blue-500/50 rounded-xl px-4 py-3 text-white font-mono font-bold placeholder-slate-700 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all text-sm" />
                                <input formControlName="roe_externo" placeholder="Externo"
                                    class="w-full bg-slate-950/50 border border-slate-800 hover:border-slate-700 focus:border-blue-500/50 rounded-xl px-4 py-3 text-white font-mono font-bold placeholder-slate-700 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all text-sm" />
                            </div>
                        </div>

                        <!-- Modulacion -->
                        <div class="space-y-2">
                            <label
                                class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1">Modulación</label>
                            <input formControlName="modulacion_obs"
                                class="w-full bg-slate-950/50 border border-slate-800 hover:border-slate-700 focus:border-blue-500/50 rounded-xl px-4 py-3 text-white font-bold placeholder-slate-700 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all text-sm" />
                        </div>

                        <!-- Squelch -->
                        <div class="space-y-2">
                            <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1">Squelch
                                / Piso Ruido</label>
                            <div class="grid grid-cols-2 gap-2">
                                <input formControlName="squelch_obs" placeholder="Squelch"
                                    class="w-full bg-slate-950/50 border border-slate-800 hover:border-slate-700 focus:border-blue-500/50 rounded-xl px-4 py-3 text-white font-bold placeholder-slate-700 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all text-sm" />
                                <input formControlName="piso_ruido_obs" placeholder="Piso Ruido"
                                    class="w-full bg-slate-950/50 border border-slate-800 hover:border-slate-700 focus:border-blue-500/50 rounded-xl px-4 py-3 text-white font-bold placeholder-slate-700 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all text-sm" />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-2 relative z-10">
                    <label class="text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Observaciones</label>
                    <textarea formControlName="observaciones" rows="8"
                        class="w-full bg-slate-950/50 border border-slate-800 hover:border-slate-700 focus:border-blue-500/50 rounded-xl p-4 text-slate-300 placeholder-slate-600 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all resize-none font-medium leading-relaxed"
                        placeholder="Ingrese detalles sobre el estado del equipo, las tareas realizadas y cualquier otra información relevante para el reporte..."></textarea>
                </div>

                <div class="mt-8 flex flex-col md:flex-row justify-end gap-4 relative z-10">
                    <button type="button" routerLink="/checklists"
                        class="w-full md:w-auto px-6 py-3 text-sm font-black text-slate-500 hover:text-white transition-colors hover:bg-slate-800 rounded-xl tracking-widest uppercase font-black">
                        CANCELAR
                    </button>
                    <button type="submit" [disabled]="loading"
                        class="w-full md:w-auto px-10 py-3 bg-blue-600 hover:bg-blue-500 text-white text-sm font-black rounded-xl shadow-lg shadow-blue-600/20 hover:shadow-blue-600/40 hover:-translate-y-0.5 active:translate-y-0 transition-all flex items-center justify-center gap-2 tracking-widest uppercase">
                        <lucide-icon [name]="Save" [size]="18"></lucide-icon>
                        {{ loading ? 'GUARDANDO...' : 'GUARDAR CAMBIOS' }}
                    </button>
                </div>
            </div>

        </form>
    </div>
</div>


<app-modal [isOpen]="showSuccessModal" (onClose)="handleSuccessClose()" title="Éxito">
    <div class="flex flex-col items-center text-center gap-4">
        <div class="bg-green-500/20 p-3 rounded-full text-green-500">
            <lucide-icon [name]="CheckCircle" [size]="48"></lucide-icon>
        </div>
        <p class="text-slate-300 text-lg">El checklist ha sido procesado correctamente.</p>
        <button (click)="handleSuccessClose()"
            class="mt-2 w-full bg-blue-600 text-white py-2.5 rounded-xl hover:bg-blue-700 transition-colors font-medium">
            Aceptar
        </button>
    </div>
</app-modal>
<div class="h-20 print:hidden"></div>